# values-traefik.yaml
deployment:
  replicas: 1
  initContainers:
    # The "volume-permissions" init container is required if you run into permission issues.
    # Related issue: https://github.com/traefik/traefik-helm-chart/issues/396
    - name: volume-permissions
      image: busybox:latest
      command: ["sh", "-c", "touch /data/acme.json; chmod -v 600 /data/acme.json"]
      volumeMounts:
       - name: data
         mountPath: /data
podSecurityContext:
  fsGroup: 1000
  fsGroupChangePolicy: "OnRootMismatch"
nodeSelector:
  # Keep Traefik on the node that owns the Service external IP (192.168.1.209)
  # so k3s servicelb does not SNAT across nodes before traffic reaches Traefik.
  kubernetes.io/hostname: w386.k8s.my.lan
# Expose via LoadBalancer; or change to NodePort if you don't have LB
service:
  type: LoadBalancer
  spec:
    externalTrafficPolicy: Local

ports:
  web:
    port: 80
    exposedPort: 80
    # redirect HTTP -> HTTPS
  websecure:
    port: 443
    exposedPort: 443
    tls:
      enabled: true
  # TCP entrypoints for non-HTTP workloads.
  submission:
    port: 587
    exposedPort: 587
    expose:
      default: true
    protocol: TCP
  imaps:
    port: 993
    exposedPort: 993
    expose:
      default: true
    protocol: TCP
  managesieve:
    port: 4190
    exposedPort: 4190
    expose:
      default: true
    protocol: TCP
  minecraft:
    port: 25565
    exposedPort: 25565
    expose:
      default: true
    protocol: TCP

# Enable Kubernetes CRDs/Providers
providers:
  kubernetesCRD:
    enabled: true
  kubernetesIngress:
    enabled: true

# Simple dashboard (optionally exposed via IngressRoute)
ingressRoute:
  dashboard:
    enabled: true

certificatesResolvers:
  letsencrypt:
    acme:
      email: "me@andreybondarenko.com"
      storage: "/data/acme.json"
      httpChallenge:
        entryPoint: web

# Persistent volume for acme.json (so certs survive restart)
persistence:
  enabled: true
  path: /data
  size: 1Gi
  accessMode: ReadWriteOnce

# Enable simple access logs
logs:
  general:
    level: INFO
  access:
    enabled: true
